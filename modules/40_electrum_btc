electrum_btc_version="3.3.6"

electrum_heredoc(){
  cat $persist/local/share/applications/electrumApp.desktop <<END
[Desktop Entry]
Comment=Lightweight Bitcoin Client
Exec=/usr/local/bin/electrum-${electrum_btc_version}-x86_64.AppImage %u
GenericName[en_US]=Bitcoin Wallet
GenericName=Bitcoin Wallet
Icon=electrum
Name[en_US]=Electrum ${electrum_btc_version} Bitcoin Wallet
Name=Electrum ${electrum_btc_version} Bitcoin Wallet
Categories=Finance;Network;
StartupNotify=false
Terminal=false
Type=Application
MimeType=x-scheme-handler/bitcoin;
Actions=Testnet;

[Desktop Action Testnet]
Exec=/usr/local/bin/electrum-${electrum_btc_version}-x86_64.AppImage --testnet %u
Name=Testnet mode
END
}

electrum_btc_s1(){
  true
}

electrum_btc_s2(){ 
  true
}

electrum_btc_s3(){
  # export msg="DBG: STAGING ELECTRUM"; zenity --info --text="$msg" 1> /dev/null 2>&1
  wget -P $assets https://raw.githubusercontent.com/spesmilo/electrum/master/pubkeys/ThomasV.asc
  wget -P $persist/local/bin/ "https://download.electrum.org/${electrum_btc_version}/electrum-${electrum_btc_version}-x86_64.AppImage"
  wget -P $assets "https://download.electrum.org/${electrum_btc_version}/electrum-${electrum_btc_version}-x86_64.AppImage.asc"
  gpg --import $assets/ThomasV.asc
  printf "trust\n5\ny\nquit\n" | gpg --command-fd 0 --edit-key "0x0a40b32812125b08fcbf90ec1a25c4602021cd84"

  # export msg="DBG: FINALIZING ELECTRUM"; zenity --info --text="$msg" 1> /dev/null 2>&1
  # move Electrum Over
  electrum_heredoc
  chmod 0700 $persist/local/share/applications/electrumApp.desktop
  chmod 0700 "$persist/local/bin/$assets/electrum-${electrum_btc_version}-x86_64.AppImage"
  gpg --verify $assets/electrum*.AppImage.asc $persist/local/bin/electrum*.AppImage
}